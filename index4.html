<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Planets of Faith</title>
  <link href="https://fonts.cdnfonts.com/css/farm-wave-free" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
<style>
body {
  margin: 0;
  background: #2a231f;
  height: 20000vh; /* ìŠ¤í¬ë¡¤ ê±°ë¦¬ */

  -ms-overflow-style: none;  /* IE, Edge */
  scrollbar-width: none;     /* Firefox */
}
body::-webkit-scrollbar {
  display: none;
}

/* ë“œë˜ê·¸ ë°©ì§€ìš© ê³µí†µ í´ë˜ìŠ¤ */
.no-select {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* ë©”ì¸ í—¤ë”© (Farm Wave í°íŠ¸) */
.main-heading {
  font-family: 'Farm Wave Free', sans-serif;
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  color: #F4E4DC;
  font-size: 2.7rem;
  text-shadow: 0 0 12px rgba(0,0,0,0.6);
  z-index: 20;
  white-space: nowrap;
}

/* ìƒë‹¨ ì„œë¸Œí…ìŠ¤íŠ¸ */
.title {
  font-family: "Gowun Batang", serif;
  position: fixed;
  top: 80px; /* ë©”ì¸ í—¤ë”© ì•„ë˜ */
  left: 50%;
  transform: translateX(-50%);
  color: #F4E4DC;
  font-size: 1rem;
  text-shadow: 0 0 8px rgba(0,0,0,0.6);
  z-index: 20;
  transition: opacity 0.25s ease;
}

/* ìˆ˜ì§‘ ê°œìˆ˜ ì¹´ìš´í„° (ê°€ìš´ë°) */
.collect-counter {
  position: fixed;
  top: 112px; /* ì„œë¸Œí…ìŠ¤íŠ¸ ë°”ë¡œ ì•„ë˜ ëŠë‚Œ */
  left: 50%;
  transform: translateX(-50%);
  font-family: "Gowun Batang", serif;
  font-size: 0.9rem;
  color: #F4E4DC;
  text-shadow: 0 0 6px rgba(0,0,0,0.6);
  z-index: 20;
}

/* ìˆ«ì ì˜¤ë¥¼ ë•Œ í†µ! í•˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
.collect-counter.bump {
  animation: counter-bump 0.28s ease-out;
}

@keyframes counter-bump {
  0% {
    transform: translateX(-50%) scale(1);
  }
  40% {
    transform: translateX(-50%) scale(1.25);
  }
  100% {
    transform: translateX(-50%) scale(1);
  }
}

/* ìµœëŒ€ ê°œìˆ˜ ì•ˆë‚´ í…ìŠ¤íŠ¸ */
.collect-limit {
  position: fixed;
  top: 135px; /* ì¹´ìš´í„° ë°”ë¡œ ì•„ë˜ */
  left: 50%;
  transform: translateX(-50%);
  font-family: "Gowun Batang", serif;
  font-size: 0.85rem;
  color: rgba(244, 228, 220, 0.75);
  text-shadow: 0 0 6px rgba(0,0,0,0.35);
  z-index: 20;
  white-space: nowrap;
  pointer-events: none;
}

/* í–‰ì„± ì „ì²´ ë°•ìŠ¤ */
.planet {
  position: fixed;
  left: 50%;
  bottom: 0;
  transform: translate(-50%, 160vw);
  width: 180vw;
  height: 180vw;
  z-index: 5;
}

/* ì‹¤ì œë¡œ íšŒì „í•˜ëŠ” í–‰ì„± ì´ë¯¸ì§€(ê°€ìƒ ìš”ì†Œ) */
.planet::before {
  content: "";
  position: absolute;
  inset: 0;
  background: url("planet0.png") center top / cover no-repeat;
  transform-origin: 50% 50%;
  transform: rotate(var(--planet-angle, 0deg));
  pointer-events: none; 
}

/* ë°°ê²½ ìš°ì£¼ ë ˆì´ì–´ */
.bg-layer {
  position: fixed;
  top: 50%;
  left: 50%;
  width: 220vmax;
  height: 220vmax;
  background: url("backgroundspace.jpg") center/cover no-repeat;
  z-index: -2;
  pointer-events: none;
  transform-origin: 50% 60%;
  transform: translate(-50%, -50%) rotate(0deg);
}

/* â­ í–‰ì„± ì¤‘ì‹¬ì„ ê¸°ì¤€ìœ¼ë¡œ ë„ëŠ” ê³ í–¥ë³„ ë ˆì´ì–´ */
.orbit-layer {
  position: absolute;
  inset: 0;
  transform-origin: 50% 50%;
  z-index: 15;
  opacity: 1;
  pointer-events: none; 
  transition: opacity 1s ease;
}

/* â­ ê³ í–¥ë³„ ì•µì»¤ + ë§ ìˆëŠ” ìŠ¤íƒ€ì¼ */
.orbit-dot {
  transform-style: preserve-3d;
  position: absolute;
  top: 50%;
  left: 50%;
  transform-origin: 50% 50%;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  pointer-events: auto;
}

/* ê³ í–¥ë³„ ìœ„ì¹˜: í–‰ì„± ìœ„ìª½ ì •ì¤‘ì•™ ê·¼ì²˜ (ì¡°ê¸ˆ ì™¼ìª½ ê¸°ìš¸ì„) */
.orbit-dot:nth-child(1) {
  transform: translate(-50%, -50%) rotate(-15deg) translateY(-114vw);
}

/* ì½”ì–´(ì‘ì€ ë³„) */
.orbit-dot::after {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #ffffff;
  transform: translate(-50%, -50%);
  box-shadow:
    0 0 4px rgba(255,255,255,0.8),
    0 0 12px rgba(255,255,255,0.9),
    0 0 22px rgba(255,255,255,0.8);
  animation: twinkle 2.4s ease-in-out infinite alternate;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

/* ë°”ê¹¥ ë§ + í›„ê´‘ */
.orbit-dot::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: 100%;
  height: 100%;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.35);
  background: radial-gradient(circle,
    rgba(255,255,255,0.18) 0,
    rgba(255,255,255,0.06) 45%,
    transparent 70%
  );
  box-shadow: 0 0 14px rgba(255,255,255,0.35);
  opacity: 0.7;
  animation: orbitPulse 2.6s ease-in-out infinite;
  pointer-events: none;
}

/* í˜¸ë²„ ì‹œ: ì½”ì–´ ê°•ì¡° */
.orbit-dot:hover::after {
  transform: translate(-50%, -50%) scale(1.5);
  animation: none;
  box-shadow:
    0 0 6px rgba(255,255,255,1),
    0 0 20px rgba(255,255,255,1),
    0 0 32px rgba(255,255,255,1);
}

/* ë§ë„ ì‚´ì§ ê°•ì¡° */
.orbit-dot:hover::before {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1.05);
}

/* ë³„ ë°˜ì§ì„ */
@keyframes twinkle {
  0%   { opacity: 0.4; box-shadow: 0 0 4px rgba(255,255,255,0.5); }
  50%  { opacity: 1;   box-shadow: 0 0 14px rgba(255,255,255,1); }
  100% { opacity: 0.6; box-shadow: 0 0 8px rgba(255,255,255,0.8); }
}

/* ë§ ìˆ¨ì‰¬ê¸° */
@keyframes orbitPulse {
  0%   { transform: translate(-50%, -50%) scale(1);    opacity: 0.5; }
  50%  { transform: translate(-50%, -50%) scale(1.12); opacity: 0.9; }
  100% { transform: translate(-50%, -50%) scale(1);    opacity: 0.5; }
}

/* íˆ´íŒ (ê³ í–¥ë³„ìš©) */
.tooltip {
  position: fixed;
  padding: 8px 12px;
  background: #F4E4DC;
  color: #2a231f;
  border-radius: 8px;
  font-family: "Gowun Batang", serif;
  font-size: 0.8rem;
  box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  pointer-events: none;
  opacity: 0;
  visibility: hidden;
  transform: translate(-15%, -50%);
  transition: opacity 0.15s ease;
  z-index: 100000;
}

.tooltip-title {
  font-weight: 700;
}

.tooltip-desc {
  line-height: 1.4;
  white-space: nowrap;
}

/* ê±·ëŠ” ìºë¦­í„° */
.walker {
  position: fixed;
  left: 50%;
  bottom: 8vh;
  transform: translateX(-50%);
  width: 800px;
  height: 800px;
  background-image: url("walkani.png");
  background-repeat: no-repeat;
  background-position: 0 0;
  transform-origin: 50% 100%;
  opacity: 1;
  transition: opacity 1s ease;
  z-index: 10;
  pointer-events: none;
}

/* ğŸ”¹ ì™¸ê³„ì¸ ë ˆì´ì–´ */
.alien-layer {
  position: absolute;
  inset: 0;
  transform-origin: 50% 50%;
  transform: rotate(var(--planet-angle, 0deg));
  z-index: 8;
  pointer-events: auto;
}

/* í–‰ì„± ë‘˜ë ˆì— ë°°ì¹˜ë  ì™¸ê³„ì¸ ì•µì»¤ */
.alien-slot {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 18vw;   /* ë§í’ì„ ì´ ìˆ¨ì‰´ ìˆ˜ ìˆê²Œ ê°€ë¡œ í­ ë„“ê²Œ */
  height: 18vw;
  transform-origin: 50% 50%;
  cursor: pointer;
}

/* ğŸ”¹ ì™¸ê³„ì¸ ìŠ¤í”„ë¼ì´íŠ¸: í¬ê¸°ëŠ” ë”°ë¡œ ì œì–´ (ë§í’ì„  í­ê³¼ ë¶„ë¦¬) */
.alien-sprite {
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 16vw;     /* ì‹¤ì œ ì™¸ê³„ì¸ í¬ê¸° */
  height: 16vw;
  transform: translateX(-50%);
  transform-origin: 50% 100%;
  background-repeat: no-repeat;
  background-size: 200% 100%; /* 2í”„ë ˆì„ ì‹œíŠ¸ */
  background-position: 0 0;
}

/* ì„ íƒëœ ì™¸ê³„ì¸ ê¸€ë¡œìš° */
.alien-sprite.glow {
  filter:
    drop-shadow(0 0 10px rgba(244, 228, 220, 0.9))
    drop-shadow(0 0 25px rgba(244, 228, 220, 0.7));
}

/* ë§í’ì„  (ê° ì™¸ê³„ì¸ ì „ìš©) */
.alien-bubble {
  position: absolute;
  left: 50%;
  bottom: calc(100% - 24px);
  transform: translateX(-50%);

  display: inline-block;

  background: #F4E4DC;
  color: #2a231f;
  font-family: "Gowun Batang", serif;
  font-size: 0.75rem;
  line-height: 1.4;

  padding: 6px 10px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);

  max-width: 120px;
  width: auto;
  white-space: normal;
  word-break: break-all;

  opacity: 0;
  z-index: 9;
  pointer-events: none;
  transition: opacity 0.2s ease;
}

/* ë§í’ì„  ê¼¬ë¦¬ (ìœ„ìª½ ë²„ì „) */
.alien-bubble::after {
  content: "";
  position: absolute;
  left: 50%;
  bottom: -6px;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 6px solid #F4E4DC;
}

/* ë§í’ì„  ë³´ì´ê¸° ìƒíƒœ */
.alien-bubble.visible,
.alien-bubble.selected {
  opacity: 1;
}

/* âœ¨ ì‹ ë‚˜ì„œ í†µí†µ ì í”„í•˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
@keyframes alien-bouncy-jump {
  0%   { transform: translateX(-50%) translateY(0) scale(1.10); }
  15%  { transform: translateX(-50%) translateY(-18px) scale(1.12, 1.08); }
  30%  { transform: translateX(-50%) translateY(-26px) scale(1.14, 1.06); }
  45%  { transform: translateX(-50%) translateY(-14px) scale(1.09, 1.12); }
  60%  { transform: translateX(-50%) translateY(0) scale(1.06, 1.14); }
  70%  { transform: translateX(-50%) translateY(-6px) scale(1.12, 1.08); }
  100% { transform: translateX(-50%) translateY(0) scale(1.10); }
}

/* í˜¸ë²„ â†’ ì í”„ */
.alien-slot:hover .alien-sprite:not(.pop) {
  animation: alien-bouncy-jump 0.45s infinite cubic-bezier(.28, .84, .42, 1);
}

/* ì„ íƒëœ ì• ë“¤ â†’ í˜¸ë²„ ì—†ì–´ë„ ê³„ì† ì í”„ */
.alien-sprite.selected:not(.pop) {
  animation: alien-bouncy-jump 0.45s infinite cubic-bezier(.28, .84, .42, 1);
}

/* í´ë¦­ ì‹œ: ì ê¹ ì‘ì•„ì¡Œë‹¤ê°€ í†µ! í•˜ê³  ëŒì•„ì˜¤ê¸° */
@keyframes alien-click-pop {
  0% {
    transform: translateX(-50%) translateY(0) scale(1);
  }
  40% {
    transform: translateX(-50%) translateY(1px) scale(0.8);
  }
  100% {
    transform: translateX(-50%) translateY(0) scale(1.05);
  }
}

/* í´ë¦­ íŒ ì• ë‹ˆë©”ì´ì…˜ */
.alien-sprite.pop {
  animation: alien-click-pop 0.2s ease-out;
}

/* ê° ì™¸ê³„ì¸ ìŠ¤í”„ë¼ì´íŠ¸ ì´ë¯¸ì§€ ì—°ê²° */
.alien1 { background-image: url("alien1.png"); }
.alien2 { background-image: url("alien2.png"); }
.alien3 { background-image: url("alien3.png"); }
.alien4 { background-image: url("alien4.png"); }
.alien5 { background-image: url("alien5.png"); }
.alien6 { background-image: url("alien6.png"); }
.alien7 { background-image: url("alien7.png"); }

/* ì „ì²´ ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
html {
  -ms-overflow-style: none;
  scrollbar-width: none;
}
html::-webkit-scrollbar {
  display: none;
}

/* ğŸ”¹ ë³„ ëª¨ì–‘ íŒŒí¸ */
.particle {
  position: fixed;
  width: 12px;
  height: 12px;
  clip-path: polygon(
    50% 0%,
    61% 35%,
    98% 35%,
    68% 57%,
    79% 100%,
    50% 75%,
    21% 100%,
    32% 57%,
    2% 35%,
    39% 35%
  );
  background: rgba(244, 228, 220, 1);
  box-shadow: 
    0 0 18px rgba(244, 228, 220, 1),
    0 0 30px rgba(244, 228, 220, 0.8);
  pointer-events: none;
  z-index: 40;

  transform: translate(0, 0) scale(1);
  animation: particleExplode 1s cubic-bezier(.12,.78,.36,.99) forwards;
}

/* ğŸ”¹ ë” ë©€ë¦¬ ì„¸ê²Œ ë‚ ì•„ê°€ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
@keyframes particleExplode {
  0% {
    transform: translate(0, 0) scale(1.2);
    opacity: 1;
  }
  100% {
    transform: translate(var(--dx), var(--dy)) scale(0.4);
    opacity: 0;
  }
}

/* â—€â–¶ í™”ì‚´í‘œ ë²„íŠ¼ */
.relation-prev-btn,
.relation-next-btn {
  display: inline-block;
  width: 0;
  height: 0;
  cursor: pointer;
  vertical-align: middle;
  transition: transform 0.2s ease, filter 0.2s ease;
  position: relative; /* íˆíŠ¸ë°•ìŠ¤ í™•ì¥ìš© ê¸°ì¤€ */
}

/* íˆíŠ¸ë°•ìŠ¤ ë„“íˆê¸° (íˆ¬ëª… ë°•ìŠ¤) */
.relation-prev-btn::before,
.relation-next-btn::before {
  content: "";
  position: absolute;
  top: -10px;
  left: -10px;
  right: -10px;
  bottom: -10px;
}

/* â—€ ì´ì „ ë²„íŠ¼ */
.relation-prev-btn {
  margin-right: 14px;
  border-top: 10px solid transparent;
  border-bottom: 10px solid transparent;
  border-right: 14px solid #F4E4DC;
}

/* â–¶ ë‹¤ìŒ ë²„íŠ¼ */
.relation-next-btn {
  margin-left: 14px;
  border-top: 10px solid transparent;
  border-bottom: 10px solid transparent;
  border-left: 14px solid #F4E4DC;
}

/* hover íš¨ê³¼ */
.relation-prev-btn:hover {
  transform: translateX(-3px);
  filter: drop-shadow(0 0 6px rgba(244, 228, 220, 0.8));
}

.relation-next-btn:hover {
  transform: translateX(3px);
  filter: drop-shadow(0 0 6px rgba(244, 228, 220, 0.8));
}

/* ğŸ”» í•˜ë‹¨ ì €ì¥ / ìˆ˜ì • ë²„íŠ¼ ì˜ì—­ */
.bottom-controls {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 8px;
  z-index: 30;
  font-family: "Gowun Batang", serif;
}

/* ê³µí†µ ë²„íŠ¼ ìŠ¤íƒ€ì¼ â€“ ê¹Šì€ ê°ˆìƒ‰ ë°°ê²½ */
.bottom-controls button {
  min-width: 110px;
  padding: 7px 14px;
  border-radius: 9px;
  border: 1px solid rgba(244, 228, 220, 0.65);

  background: rgba(58, 46, 40, 0.75); /* ê¹Šì€ ê°ˆìƒ‰ */
  color: #F4E4DC;
  font-size: 0.82rem;
  letter-spacing: 0.02em;
  cursor: pointer;

  box-shadow: 0 4px 10px rgba(60, 45, 35, 0.55);

  transition:
    background 0.18s ease,
    transform 0.12s ease,
    box-shadow 0.18s ease,
    border-color 0.18s ease,
    opacity 0.18s ease;
}

/* hover ê·¸ë¦¼ìë„ ê°ˆìƒ‰ ê¸°ë°˜ìœ¼ë¡œ */
.bottom-controls button:hover:not(.saved) {
  background: rgba(78, 62, 52, 0.88);
  border-color: rgba(244, 228, 220, 0.9);
  box-shadow: 0 6px 14px rgba(74, 58, 46, 0.55);
  transform: translateY(-1px);
}

/* ì €ì¥ëœ ìƒíƒœ ê·¸ë¦¼ì */
.save-btn.saved {
  background: rgba(244, 228, 220, 0.92);
  color: #2a231f;
  border-color: rgba(244, 228, 220, 0.92);
  box-shadow: 0 4px 12px rgba(64, 48, 38, 0.40);
  cursor: default;
}

/* ì €ì¥ë¨ì¼ ë•Œ hover ë³€í™” ìµœì†Œí™” */
.save-btn.saved:hover {
  background: rgba(244, 228, 220, 0.92);
  transform: none;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);
}

/* ìˆ˜ì •í•˜ê¸° ë²„íŠ¼ */
.edit-btn {
  opacity: 0.85;
}
.edit-btn:hover {
  opacity: 1;
  background: rgba(78, 62, 52, 0.4);
}
</style>
</head>

<body>
  <div id="page-transition"></div>
  <!-- ë°°ê²½ ìš°ì£¼ -->
  <div class="bg-layer"></div>

  <!-- í–‰ì„± + ê³ í–¥ë³„ + ì™¸ê³„ì¸ë“¤ -->
  <div class="planet">
    <div class="orbit-layer">
      <div class="orbit-dot"
           data-title="Go Home"
           data-desc="íƒí—˜ì„ ë§ˆì¹œ ë’¤ ê³ í–¥ë³„ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤."></div>
    </div>

    <!-- ì™¸ê³„ì¸ë“¤: JSê°€ 35ë§ˆë¦¬ ì±„ìš¸ ì˜ˆì • -->
    <div class="alien-layer"></div>
  </div>

  <!-- ìƒë‹¨ í…ìŠ¤íŠ¸ë“¤ -->
  <div class="main-heading no-select">
    <span class="relation-prev-btn"></span>
    The Planet of Emotion
    <span class="relation-next-btn"></span>
  </div>
  <div class="title no-select">í–‰ì„±ì„ íƒí—˜í•˜ë©°, ë§ˆìŒì— ë“œëŠ” ë§ë“¤ì„ í´ë¦­í•´ ìˆ˜ì§‘í•´ë³´ì„¸ìš”.</div>
  <div class="collect-counter no-select">ìˆ˜ì§‘í•œ ê°¯ìˆ˜ : 0</div>
  <div class="collect-limit no-select">*ìµœëŒ€ 10ê°œ*</div>

  <!-- ê±·ëŠ” ìºë¦­í„° -->
  <div class="walker"></div>

  <!-- íˆ´íŒ (ê³ í–¥ë³„ìš©) -->
  <div class="tooltip" id="planetTooltip">
    <div class="tooltip-title"></div>
    <div class="tooltip-desc"></div>
  </div>

  <!-- í•˜ë‹¨ ì €ì¥ / ìˆ˜ì • ë²„íŠ¼ -->
  <div class="bottom-controls no-select">
    <button class="save-btn" type="button">ì €ì¥í•˜ê¸°</button>
    <button class="edit-btn" type="button" style="display:none;">ìˆ˜ì •í•˜ê¸°</button>
  </div>

<script>

/* ============================
   ê¸°ë³¸ ìš”ì†Œ ì„ íƒ
============================ */
const planet = document.querySelector('.planet');
const bg = document.querySelector('.bg-layer');
const walker = document.querySelector('.walker');
const orbitLayer = document.querySelector('.orbit-layer');
const dots = document.querySelectorAll('.orbit-dot');
const alienLayer = document.querySelector('.alien-layer');

const tooltip = document.getElementById('planetTooltip');
const tooltipTitle = tooltip.querySelector('.tooltip-title');
const tooltipDesc = tooltip.querySelector('.tooltip-desc');

/* ğŸ”¢ ìˆ˜ì§‘ ì¹´ìš´í„° */
let collected = 0;
const MAX_COLLECT = 10;
const counterEl = document.querySelector('.collect-counter');

/* ğŸ” ì €ì¥ ìƒíƒœ */
let isSaved = false;
const saveBtn = document.querySelector('.save-btn');
const editBtn = document.querySelector('.edit-btn');

/* ì„ íƒëœ ì¸ë±ìŠ¤ ì €ì¥ìš© */
let selectedIndices = [];

/* ì¹´ìš´í„° í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ */
function updateCounter(bump = true) {
  if (!counterEl) return;
  counterEl.textContent = `ìˆ˜ì§‘í•œ ë§: ${collected}`;
  if (bump) {
    counterEl.classList.remove('bump');
    void counterEl.offsetWidth; // reflow
    counterEl.classList.add('bump');
  }
}

/* ============================
   ì™¸ê³„ì¸ ëŒ€ì‚¬ ë¦¬ìŠ¤íŠ¸
============================ */
const ALIEN_LINES = [
  "ê¸°ë¶„ì´ ì´ìƒí•˜ë©´ ë°”ë¡œ ì´ìœ ë¥¼ ì°¾ì•„ë³´ëŠ” ê²ƒì´ ì¢‹ì•„ìš”.","ê¸°ë¶„ì´ ì´ìƒí•´ë„ ê·¸ëŸ¬ë ¤ë‹ˆ í•˜ê³  ë„˜ê²¨ìš”.",
  "ê°ì •ì€ ì¦‰ê°ì ìœ¼ë¡œ ë“œëŸ¬ë‚´ëŠ” ê²ƒì´ ê±´ê°•í•´ìš”.","ê°ì •ì€ í•œ ë²ˆ ê±¸ëŸ¬ì„œ ë§í•´ì•¼ ì•ˆì „í•´ìš”.",
  "ìŠ¬í”„ë©´ ìš¸ê³  ë‚˜ì„œ ê°ì •ì´ ì •ë¦¬ë¼ìš”.","ìš¸ë©´ ë§ˆìŒì´ ë³µì¡í•´ì ¸ì„œ ì›¬ë§Œí•˜ë©´ ìš¸ì§€ ì•Šì•„ìš”.",
  "ê°ì •ì˜ ì›ì¸ì€ ìƒí™© ìì²´ì—ì„œ ì™€ìš”.","ê°ì •ì˜ ì›ì¸ì€ í•´ì„ê³¼ ìƒê°ì—ì„œ ì™€ìš”.",
  "ê°ì •ì˜ í†µì œëŠ” ê°€ëŠ¥í•´ìš”.","ê°ì •ì€ í†µì œê°€ ë¶ˆê°€ëŠ¥í•´ìš”.",
  "í–‰ë³µì€ ë‚˜ëˆŒìˆ˜ë¡ ì»¤ì ¸ìš”.","í–‰ë³µì„ ë‚¨ì—ê²Œ ë³´ì—¬ì¤„ í•„ìš” ì—†ì–´ìš”.",
  "ê°ì •ì€ ì†”ì§í•¨ì˜ ì¦ê±°ì—ìš”.","ê°ì •ì€ ì§„ì‹¤ì„ ê°€ë ¤ìš”.",
  "ê°ì •ì€ ëª¸ìœ¼ë¡œ ë°”ë¡œ ë“œëŸ¬ë‚˜ìš”.","ê°ì •ì€ ë‚˜ë¥¼ ì´í•´í•˜ëŠ” ë„êµ¬ì—ìš”.",
  "ë¬´ë„ˆì ¸ë„ ê¸ˆë°© ë‹¤ì‹œ ì „í™˜í•˜ëŠ” í¸ì´ì—ìš”.","ê°ì •ì´ í•œ ë²ˆ í”ë“¤ë¦¬ë©´ ìƒí™œ ì „ì²´ì— ì˜í–¥ì´ ì»¤ìš”.",
  "ê°ì •ì€ ë•Œë•Œë¡œ ë°©í•´ ìš”ì†Œë¼ ì¤„ì´ê³  ì‹¶ì–´ìš”.","ê¸°ì¨ì—ì„œ ì°½ì‘ì´ë‚˜ ì˜ê°ì„ ì–»ì–´ìš”.",
  "ìŠ¬í””ì—ì„œ ì°½ì‘ì´ë‚˜ ì˜ê°ì„ ì–»ì–´ìš”.","ê°ì • ë³´ë‹¤ëŠ” êµ¬ì¡°ë‚˜ ë…¼ë¦¬ì—ì„œ ì˜ê°ì„ ì–»ì–´ìš”.",
  "ìŠ¬í””ì€ ì¶©ë¶„íˆ ëŠë¼ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”.","ìŠ¬í””ì€ ìµœëŒ€í•œ ë¹¨ë¦¬ ìŠì–´ì•¼í•´ìš”.",
  "ê°ì •ì„ ë“œëŸ¬ë‚´ë©´ ê°€ê¹Œì›Œì§„ë‹¤ê³  ë¯¿ì–´ìš”.","ê°ì •ì„ ë“œëŸ¬ë‚´ë©´ ì·¨ì•½í•´ì§„ë‹¤ê³  ëŠê»´ìš”.",
  "ë‚´ ê°ì •ì„ ìˆëŠ” ê·¸ëŒ€ë¡œ ë°›ì•„ë“¤ì´ë ¤ í•´ìš”.","ê°ì •ì´ ìƒê²¨ë„ ê°ì •ì¼ ë¿ì´ë¼ê³  ê±°ë¦¬ë¥¼ ë‘ë ¤í•´ìš”.",
  "ê°ì •ì´ ë³µì¡í•´ë„ ë‚˜ ìì‹ ì´ ë¶€ë„ëŸ½ì§€ ì•Šì•„ìš”.","ê°ì •ì´ ë³µì¡í•˜ë©´ ì™œ ì´ëŸ¬ëŠ” ì§€ ìì±…í•˜ëŠ” í¸ì´ì—ìš”.",
  "ìŠ¬í””ì€ ë‚˜ëˆ„ë©´ ë°˜ì´ ë¼ìš”.","ìŠ¬í””ì€ ë‚˜ëˆ„ë©´ ë‘ë°°ê°€ ë¼ìš”.",
  "ì§€ê¸ˆ ëŠë¼ëŠ” ê°ì •ì´ ì •í™•í•˜ë‹¤ê³  ë¯¿ì–´ìš”.","ê°ì •ì€ ìˆœê°„ì ì´ë¼ ë„ˆë¬´ ë¯¿ì§€ ì•Šìœ¼ë ¤í•´ìš”.",
  "ì›¬ë§Œí•œ ì¼ì—ëŠ” ê°ì •ì´ í¬ê²Œ ì•ˆ ì›€ì§ì—¬ìš”."
];

const ALIEN_IMAGES = [
  "alien1.png","alien2.png","alien3.png","alien4.png","alien5.png","alien6.png","alien7.png"
];

/* ============================
   ì™¸ê³„ì¸ 35ê°œ ë°°ì¹˜
============================ */
alienLayer.innerHTML = "";
const ALIEN_COUNT = 35;
const RADIUS_VW = -95;

for (let i = 0; i < ALIEN_COUNT; i++) {
  const slot = document.createElement('div');
  slot.className = 'alien-slot';
  slot.dataset.index = String(i);

  const sprite = document.createElement('div');
  sprite.className = 'alien-sprite';
  sprite.style.backgroundImage = `url("${ALIEN_IMAGES[i % 7]}")`;

  const bubble = document.createElement('div');
  bubble.className = 'alien-bubble';
  bubble.textContent = ALIEN_LINES[i];

  slot.appendChild(sprite);
  slot.appendChild(bubble);

  const angle = (360 / ALIEN_COUNT) * i;
  slot.style.transform =
    `translate(-50%, -50%) rotate(${angle}deg) translateY(${RADIUS_VW}vw)`;

  alienLayer.appendChild(slot);
}

/* ìŠ¬ë¡¯ ë‹¤ì‹œ ì„ íƒ */
const alienSlots = document.querySelectorAll('.alien-slot');

/* ============================
   ğŸ” ì €ì¥ëœ ìƒíƒœ ë³µì›
============================ */
/* ============================
   ğŸ” ì €ì¥ëœ ìƒíƒœ ë³µì›
============================ */
function applySavedStateIfAny() {
  // 1) ì„ íƒ ì¸ë±ìŠ¤ ë°°ì—´ ì½ê¸°
  let savedSel = [];
  try {
    const raw = localStorage.getItem('emotionPlanetSelections');
    if (raw) savedSel = JSON.parse(raw);
  } catch (e) {
    savedSel = [];
  }

  // ì„ íƒê°’ì´ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ â†’ ê·¸ëƒ¥ ì´ˆê¸° ìƒíƒœ
  if (!Array.isArray(savedSel) || savedSel.length === 0) {
    collected = 0;
    selectedIndices = [];
    updateCounter(false);
    return;
  }

  // ì„ íƒê°’ì€ ìˆë˜, "ì™„ì „íˆ ì €ì¥ëœ ìƒíƒœ"ì¸ì§€ ì—¬ë¶€ëŠ” ë³„ë„ í”Œë˜ê·¸ë¡œ íŒë‹¨
  const done = localStorage.getItem('emotionPlanetDone') === 'true';

  selectedIndices = savedSel
    .map(n => Number(n))
    .filter(i => Number.isInteger(i) && i >= 0 && i < alienSlots.length);

  collected = selectedIndices.length;
  updateCounter(false);

  selectedIndices.forEach(i => {
    const slot   = alienSlots[i];
    if (!slot) return;
    const bubble = slot.querySelector('.alien-bubble');
    const sprite = slot.querySelector('.alien-sprite');
    if (!bubble || !sprite) return;

    bubble.classList.add('selected', 'visible');
    sprite.classList.add('glow', 'selected');
  });

  // âœ… done ì—¬ë¶€ì— ë”°ë¼ ë²„íŠ¼ ìƒíƒœë§Œ ë‹¬ë¦¬
  if (done) {
    isSaved = true;
    saveBtn.textContent = "ì €ì¥ë¨ âœ“";
    saveBtn.classList.add("saved");
    editBtn.style.display = "inline-block";
  } else {
    isSaved = false; // ì„ íƒì€ ë³µì›ë˜ì§€ë§Œ, ì•„ì§ 'ì €ì¥ë¨' ìƒíƒœëŠ” ì•„ë‹˜
    saveBtn.textContent = "ì €ì¥í•˜ê¸°";
    saveBtn.classList.remove("saved");
    editBtn.style.display = "none";
  }
}


/* í˜ì´ì§€ ë“¤ì–´ì˜¤ìë§ˆì ë³µì› ì‹œë„ */
applySavedStateIfAny();

/* ============================
   ë§í’ì„  + ì„ íƒ ë°˜ì‘ (ìˆ˜ì§‘ ì¹´ìš´í„° + ì ê¸ˆ ìƒíƒœ ë°˜ì˜)
============================ */
alienSlots.forEach(slot => {
  const bubble = slot.querySelector('.alien-bubble');
  const sprite = slot.querySelector('.alien-sprite');

  slot.addEventListener("mouseenter", () => {
    if (isSaved) return; // ì €ì¥ëœ ìƒíƒœë©´ hover ë§‰ê¸°
    bubble.classList.add("visible");
  });

  slot.addEventListener("mouseleave", () => {
    if (isSaved) return;
    if (!bubble.classList.contains("selected"))
      bubble.classList.remove("visible");
  });

  // í´ë¦­ í† ê¸€ + ìˆ˜ì§‘ ë¡œì§
  slot.addEventListener("click", () => {
    if (isSaved) return; // ğŸ” ì €ì¥ ìƒíƒœì—ì„œëŠ” ë” ì´ìƒ ì„ íƒ ë¶ˆê°€

    const idx = Number(slot.dataset.index);
    const now = !bubble.classList.contains("selected");

    // í´ë¦­ íŒ
    sprite.classList.add("pop");
    setTimeout(() => sprite.classList.remove("pop"), 220);

    if (now) {
      // ìƒˆë¡œ ì„ íƒí•˜ë ¤ê³  í•  ë•Œ
      if (collected >= MAX_COLLECT) {
        updateCounter(true); // ìµœëŒ€ë©´ ì¹´ìš´í„°ë§Œ í†µ!
        return;
      }

      bubble.classList.add("selected", "visible");
      sprite.classList.add("glow", "selected");
      spawnParticlesAt(sprite);

      collected++;
      updateCounter(true);

      if (!selectedIndices.includes(idx)) {
        selectedIndices.push(idx);
      }
    } else {
      // ì„ íƒ í•´ì œ
      bubble.classList.remove("selected", "visible");
      sprite.classList.remove("glow", "selected");

      if (collected > 0) collected--;
      updateCounter(false);

      selectedIndices = selectedIndices.filter(n => n !== idx);
    }
  });
});

// ì´ˆê¸° ì¹´ìš´í„° ì„¸íŒ… (ë³µì›ì—ì„œ ì´ë¯¸ í–ˆì§€ë§Œ ì•ˆì „í•˜ê²Œ í•œ ë²ˆ ë”)
updateCounter(false);

/* ============================
   ì™¸ê³„ì¸ ìŠ¤í”„ë¼ì´íŠ¸ ì• ë‹ˆë©”ì´ì…˜
============================ */
const aliens = document.querySelectorAll('.alien-sprite');
let alienFrame = 0;
const FRAME_VW = 16;
setInterval(() => {
  alienFrame = 1 - alienFrame;
  aliens.forEach(a => {
    a.style.backgroundPosition = `${-FRAME_VW * alienFrame}vw 0`;
  });
}, 250);

/* ============================
   íŒŒí‹°í´ íš¨ê³¼
============================ */
function spawnParticlesAt(target) {
  const rect = target.getBoundingClientRect();
  const cx = rect.left + rect.width / 2;
  const cy = rect.top + rect.height / 2;

  for (let i = 0; i < 18; i++) {
    const p = document.createElement("div");
    p.className = "particle";
    p.style.left = cx + "px";
    p.style.top = cy + "px";

    const angle = Math.random() * Math.PI * 2;
    const dist = 100 + Math.random() * 120;

    p.style.setProperty("--dx", `${Math.cos(angle) * dist}px`);
    p.style.setProperty("--dy", `${Math.sin(angle) * dist}px`);

    document.body.appendChild(p);
    setTimeout(() => p.remove(), 900);
  }
}

/* ============================
   ê³ í–¥ë³„ íˆ´íŒ
============================ */
let hoveredDot = null;
let tooltipAnimId = null;

function updateTooltipPosition() {
  if (!hoveredDot) return;

  const r = hoveredDot.getBoundingClientRect();
  const cx = r.left + r.width / 2;
  const cy = r.top + r.height / 2;

  tooltip.style.left = cx + 65 + "px";
  tooltip.style.top = cy + "px";

  tooltipAnimId = requestAnimationFrame(updateTooltipPosition);
}

dots.forEach(dot => {
  const title = dot.dataset.title;
  const desc = dot.dataset.desc;

  dot.addEventListener("mouseenter", () => {
    if (!title) return;
    hoveredDot = dot;

    tooltipTitle.textContent = title;
    tooltipDesc.textContent = desc || "";

    tooltip.style.opacity = 1;
    tooltip.style.visibility = "visible";

    if (tooltipAnimId) cancelAnimationFrame(tooltipAnimId);
    updateTooltipPosition();
  });

  dot.addEventListener("mouseleave", () => {
    hoveredDot = null;
    if (tooltipAnimId) cancelAnimationFrame(tooltipAnimId);
    tooltip.style.opacity = 0;
    tooltip.style.visibility = "hidden";
  });

  dot.addEventListener("click", () => {
    if (dot.dataset.title === "Go Home") {
      window.location.href = "index.html?skipIntro=true";
    }
  });
});

/* ============================
   í–‰ì„± / ë°°ê²½ íšŒì „ + ìºë¦­í„° ê±·ê¸°
============================ */
let planetAngle = 0;
let bgAngle = 0;

const CHAR_FRAME_WIDTH = 800;
const TOTAL_FRAMES = 12;
const IDLE_FRAME = 0;
let currentFrame = IDLE_FRAME;
let frameProgress = 0;
let stopTimer = null;

let walkerDirection = 1;

function positionWalker() {
  const rect = planet.getBoundingClientRect();
  const size = rect.width;
  const scale = (size * 0.25) / CHAR_FRAME_WIDTH;
  walker.style.transform = `translateX(-50%) scale(${walkerDirection * scale}, ${scale})`;

  const planetTop = rect.top;
  const bottom = (window.innerHeight - planetTop) - size * 0.06;
  walker.style.bottom = `${bottom}px`;
}
positionWalker();
window.addEventListener("resize", positionWalker);

function setWalkerFrame(i) {
  walker.style.backgroundPosition = `${-CHAR_FRAME_WIDTH * i}px 0`;
}

/* wheel ê¸°ë°˜ íšŒì „ + ê±·ê¸° */
window.addEventListener("wheel", (e) => {
  const delta = e.deltaY;
  if (delta === 0) return;

  const dir = delta > 0 ? 1 : -1;
  let d = Math.abs(delta);
  if (d < 0.5) d = 0.5;
  if (d > 80) d = 80;

  planetAngle += dir * d * 0.03;
  bgAngle += dir * d * 0.003;

  planet.style.setProperty("--planet-angle", `${planetAngle}deg`);
  alienLayer.style.transform = `rotate(${planetAngle}deg)`;
  bg.style.transform = `translate(-50%, -50%) rotate(${bgAngle}deg)`;

  walkerDirection = dir > 0 ? 1 : -1;
  positionWalker();

  let speed = d;
  if (speed < 0.8) speed = 0.8;
  if (speed > 8) speed = 8;

  frameProgress += speed * 0.05;

  while (frameProgress >= 1) {
    frameProgress -= 1;
    currentFrame = currentFrame === IDLE_FRAME ? 1 : currentFrame + 1;
    if (currentFrame >= TOTAL_FRAMES) currentFrame = 1;
    setWalkerFrame(currentFrame);
  }

  if (stopTimer) clearTimeout(stopTimer);
  stopTimer = setTimeout(() => {
    currentFrame = IDLE_FRAME;
    frameProgress = 0;
    setWalkerFrame(currentFrame);
  }, 250);
});

/* ============================
   ì¢Œ/ìš° í™”ì‚´í‘œ í´ë¦­ + í˜¸ë²„ í…ìŠ¤íŠ¸
============================ */
const prevBtn = document.querySelector(".relation-prev-btn");
const nextBtn = document.querySelector(".relation-next-btn");
const subTitle = document.querySelector(".title");

const DEFAULT_TEXT = "í–‰ì„±ì„ íƒí—˜í•˜ë©°, ë§ˆìŒì— ë“œëŠ” ë§ë“¤ì„ í´ë¦­í•´ ìˆ˜ì§‘í•´ë³´ì„¸ìš”.";

/* ğŸ”¹ ìë§‰ í…ìŠ¤íŠ¸ë¥¼ ë¶€ë“œëŸ½ê²Œ ë°”ê¾¸ëŠ” í•¨ìˆ˜ */
let subtitleTimer = null;
function setSubtitleText(text) {
  if (!subTitle) return;

  if (subtitleTimer) {
    clearTimeout(subtitleTimer);
    subtitleTimer = null;
  }

  subTitle.style.opacity = 0;
  subtitleTimer = setTimeout(() => {
    subTitle.textContent = text;
    subTitle.style.opacity = 1;
  }, 150);
}

/* â—€ ì´ì „ ë²„íŠ¼ */
prevBtn.addEventListener("mouseenter", () => {
  setSubtitleText("ì´ì „ í–‰ì„±ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.");
});
prevBtn.addEventListener("mouseleave", () => {
  setSubtitleText(DEFAULT_TEXT);
});

/* â–¶ ë‹¤ìŒ ë²„íŠ¼ */
nextBtn.addEventListener("mouseenter", () => {
  setSubtitleText("ë‹¤ìŒ í–‰ì„±ìœ¼ë¡œ ì§„ì…í•©ë‹ˆë‹¤.");
});
nextBtn.addEventListener("mouseleave", () => {
  setSubtitleText(DEFAULT_TEXT);
});

/* í´ë¦­ ì´ë™ */
prevBtn.addEventListener("click", () => {
  window.location.href = 'index3.html';
});
nextBtn.addEventListener("click", () => {
  window.location.href = 'index5.html';
});

/* ============================
   ğŸ” ì €ì¥ / ìˆ˜ì • ë²„íŠ¼ ë¡œì§
============================ */

/* ì €ì¥í•˜ê¸°: í˜„ì¬ ì„ íƒ ìƒíƒœë¥¼ â€œê³ ì •â€ + localStorageì— ê¸°ë¡ */
saveBtn.addEventListener("click", () => {
  if (isSaved) return;
  isSaved = true;

  saveBtn.textContent = "ì €ì¥ë¨ âœ“";
  saveBtn.classList.add("saved");
  editBtn.style.display = "inline-block";

  // ğŸ”¹ ì´ë•Œë§Œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ê¸°ë¡
  localStorage.setItem("emotionPlanetDone", "true");
  localStorage.setItem("emotionPlanetSelections", JSON.stringify(selectedIndices));
});


/* ìˆ˜ì •í•˜ê¸°: ë‹¤ì‹œ í¸ì§‘ ê°€ëŠ¥ (ì ê¸ˆ í•´ì œ, but ì €ì¥ê°’ì€ ìœ ì§€ â†’ ë‹¤ì‹œ ì €ì¥í•´ì•¼ ê°±ì‹ ë¨) */
editBtn.addEventListener("click", () => {
  isSaved = false;

  saveBtn.textContent = "ì €ì¥í•˜ê¸°";
  saveBtn.classList.remove("saved");
  editBtn.style.display = "none";
});
</script>

</body>
</html>
